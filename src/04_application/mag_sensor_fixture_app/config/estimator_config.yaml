# 磁铁姿态估计器节点配置文件
# 日志级别：DEBUG, INFO, WARN, ERROR, FATAL（默认 INFO）
logging_level: INFO
config:
  frames:
    output_frame: sensor_array
    magnet_frame: magnet_estimated
    enable_tf: true

  topics:
    mag_field: /magnetic/sensor/field
    mag_batch: /magnetic/sensor/batch
    pose_estimate: /magnetic/pose_estimated

  params:
    estimator:
      type: optimizer
      tf_timeout: 0.1

    ekf:
      position_gain: 0.02
      process_noise_position: 1.0e-4
      process_noise_orientation: 5.0e-5
      measurement_noise: 1.0e-3
      world_field: [0.02, 0.01, 0.045]

    preprocessor:
      enable_calibration: false
      soft_iron_matrix: [1.02, 0.00, 0.00,
                         0.00, 0.99, 0.01,
                         0.00, 0.01, 1.01]
      hard_iron_offset: [1.0, -2.0, 0.5]
      enable_filter: false
      low_pass_alpha: 0.2

    optimizer:
      min_sensors: 25
      initial_position: [0.02, 0.02, 0.03]  # 真实位置
      initial_direction: [1.0, 0.0, 0.0]  # 真实方向（RPY [0, π/2, 0] 对应 X 轴方向）
      initial_strength: 10.0  # 仿真磁矩强度（真实值）
      strength_delta: 5.0
      optimize_strength: false
      max_iterations: 100
      function_tolerance: 1.0e-6  # 放宽函数值容差，避免过度优化
      gradient_tolerance: 1.0e-8  # 放宽梯度容差
      parameter_tolerance: 1.0e-8  # 放宽参数容差
      num_threads: 8
      minimizer_progress: false # 是否显示优化器进度信息
      linear_solver: DENSE_QR
      max_acceptable_residual: 1.0  # 可接受的最大平均残差 (mT)，超过此值即使优化收敛也认为失败

    window_optimizer:
      window_size: 10  # 滑动窗口长度 L
      dt: 0.01  # 采样周期（秒）
      m0: 10  # 磁偶极矩模长 (Am²)
      mu0: 1.2566370614e-6  # 真空磁导率 (4π × 10⁻⁷ H/m)，可选，有默认值
      sigma_meas: 0.001  # 测量噪声标准差 (1e-3)
      sigma_proc_p: 0.01  # 位置过程噪声标准差 (1e-2)
      sigma_proc_v: 0.01  # 速度过程噪声标准差 (1e-2)
      sigma_proc_u: 0.01  # 磁化方向过程噪声标准差 (1e-2)
      sigma_unit: 0.01  # 单位向量约束残差标准差 (1e-2)
      max_iters: 20  # 最大迭代次数
      lambda_init: 0.001  # LM 初始阻尼参数 (1e-3)
      verbose: false  # 是否输出调试信息，可选，默认 false