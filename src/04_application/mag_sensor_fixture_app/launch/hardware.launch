<?xml version="1.0"?>
<launch>
  <!-- 参数配置 -->
  <!-- 硬件专用配置 -->
  <arg name="sensor_hardware_config" 
       default="$(find mag_sensor_fixture_app)/hardware/config/sensor_driver.yaml"/>
  <!-- 共用配置 -->
  <arg name="sensor_array_config" default="$(find mag_core_description)/config/sensor_array.yaml"/>
  <arg name="estimator_config" default="$(find mag_sensor_fixture_app)/config/estimator_config.yaml"/>
  <arg name="viz_config" default="$(find mag_sensor_fixture_app)/config/magnet_viz_config.yaml"/>
  <arg name="sensor_viz_config" default="$(find mag_sensor_fixture_app)/config/sensor_array_viz_config.yaml"/>
  <arg name="use_rviz" default="true"/>

  <!-- 传感器硬件驱动节点：读取阵列信号并广播 TF -->
  <node pkg="mag_device_sensor" type="sensor_driver_node" name="mag_device_sensor" output="screen">
    <rosparam command="load" file="$(arg sensor_array_config)" ns="array"/>
    <rosparam command="load" file="$(arg sensor_hardware_config)"/>
  </node>

  <!-- 姿态估计节点：估计磁体姿态 -->
  <node pkg="mag_pose_estimator" type="mag_pose_estimator_node" name="mag_pose_estimator" output="screen">
    <rosparam command="load" file="$(arg estimator_config)"/>
  </node>

  <!-- 可视化节点：展示估计结果（可叠加外部真值源） -->
  <node pkg="mag_viz" type="magnet_viz_node" name="magnet_viz" output="screen">
    <rosparam command="load" file="$(arg viz_config)"/>
  </node>

  <!-- 传感器阵列可视化节点 -->
  <node pkg="mag_viz" type="sensor_array_viz_node" name="sensor_array_viz" output="screen">
    <rosparam command="load" file="$(arg sensor_viz_config)"/>
    <rosparam command="load" file="$(arg sensor_array_config)" ns="array"/>
  </node>

  <!-- RViz 可视化 -->
  <group if="$(arg use_rviz)">
    <!-- 将 rviz 输出重定向到 log，不在终端显示 -->
    <node pkg="rviz" type="rviz" name="magnet_viz_rviz" 
          args="-d $(find mag_sensor_fixture_app)/rviz/magnet_viz.rviz" output="screen">
      <!-- 设置 rviz 相关日志级别为 WARN，过滤 INFO 信息 -->
      <env name="ROSCONSOLE_MIN_SEVERITY" value="WARN"/>
    </node>
  </group>
</launch>

