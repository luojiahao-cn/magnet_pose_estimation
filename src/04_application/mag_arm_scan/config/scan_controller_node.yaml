# 扫描控制节点配置文件
# 日志级别：DEBUG, INFO, WARN, ERROR, FATAL（默认 INFO）
logging_level: DEBUG
# 机械臂名称（对应 mag_device_arm 配置中的 arm name）
arm_name: arm1

config:
  # 坐标系配置
  frames:
    reference_frame: world
    end_effector_link: arm1_bracket_tcp_link

  # 话题配置
  topics:
    mag_field: /mag_sensor/data_mT

  # 功能参数
  params:
    # 扫描控制
    autostart: true
    wait_time: 2.0
    max_stable_wait_time: 10.0
    output_base_dir: src/04_application/mag_arm_scan/data

    # 扫描姿态（弧度）
    # roll: 滚转角，控制传感器绕前后轴的旋转（默认 0.0，水平扫描时通常为 0）
    roll: 0.0
    # pitch: 俯仰角，控制传感器上下倾斜
    #   -3.14159 (-π): 竖直朝下
    #   -1.5708 (-π/2): 水平朝前（类似擦玻璃）
    #   0.0: 水平朝上
    pitch: -1.5708
    # yaw: 偏航角，控制传感器左右旋转
    #   0.0: 朝前
    #   3.14159 (π): 朝后（旋转180度）
    yaw: 3.14159

    # 扫描体积边界与步长（米）
    # volume_min: 扫描体积的最小边界 [x_min, y_min, z_min]
    # volume_max: 扫描体积的最大边界 [x_max, y_max, z_max]
    # step: 每个维度的扫描步长 [step_x, step_y, step_z]
    # 系统会在 volume_min 到 volume_max 的范围内，按照 step 指定的步长生成三维网格扫描点
    # 扫描点总数 = ceil((x_max-x_min)/step_x) × ceil((y_max-y_min)/step_y) × ceil((z_max-z_min)/step_z)
    volume_min: [0.5, -0.2, 1.0]
    volume_max: [0.7, 0.2, 1.3]
    step: [0.01, 0.01, 0.01]

    # 传感器采样参数
    frames_per_sensor: 10
    max_sample_wait_time: 5.0
    required_num_sensors: 25
    sensor_detect_time: 10.0

  # 运动参数
  motion:
    # 笛卡尔路径阈值（米）：当当前位置和目标位置距离小于此值时，使用笛卡尔路径规划（直线移动）
    # 这样可以避免近距离移动时出现大角度旋转的问题。设置为 0.0 或负值将禁用此功能
    cartesian_path_threshold: 0.3
    max_velocity_scaling: 0.2
    max_acceleration_scaling: 0.1
    ready_target_name: ready

  # 可视化配置
  visualization:
    enabled: true
    topic: /mag_field_vectors
    arrow_length: 0.02
    arrow_shaft_ratio: 0.1
    arrow_head_ratio: 0.25
    arrow_head_length_ratio: 0.3
    magnitude_min: 0.0
    magnitude_max: 5.0
    alpha: 1.0
    color_low: [0.0, 0.0, 1.0]
    color_high: [1.0, 0.0, 0.0]
    use_tf_sensor_pose: true
    sensor_frame_prefix: sensor_
    tf_lookup_timeout: 0.05

  # 可选覆盖：如果希望覆盖特定测试点，可在此给出若干 (x, y, z, roll, pitch, yaw) 组合。
  # 如果设置，将覆盖默认的网格扫描顺序，按列表顺序执行。
  # overrides:
    # test_points:
      # - [0.38, 0.00, 1.05, 0.0, -3.14159, 0.0]
      # - [0.44, 0.12, 1.18, 0.0, -3.05433, 0.30]
      # - [0.46, -0.10, 1.22, 0.0, -3.05433, -0.30]
      # - [0.34, 0.00, 1.15, 0.0, -3.14159, 0.785398]
